from decimal import Decimal
import datetime

goods = {
    'Пельмени Универсальные': [
        {'amount': Decimal('0.5'), 'expiration_date': datetime.date(2024, 5, 15)}, 
        {'amount': Decimal('2'), 'expiration_date': datetime.date(2024, 5, 8)}
    ], 
    'Вода': [
        {'amount': Decimal('1.5'), 'expiration_date': None}
    ], 
    'Яйца фабрики №7': [
        {'amount': Decimal('0'), 'expiration_date': datetime.date(2024, 5, 9)}
    ], 
    'Яйца фабрики №1': [
        {'amount': Decimal('10'), 'expiration_date': datetime.date(2024, 5, 8)}
    ]
}

def add(items, title, amount, expiration_date=None):
    # Проверяем наличие expiration_date
    if expiration_date != None:
        expiration_date = str.split(expiration_date, '-')
        expiration_date = datetime.date(
            int(expiration_date[0]), 
            int(expiration_date[1]), 
            int(expiration_date[2])
        )
    # Проверяем наличие ключа title в словаре items
    if items.get(title) != None:
        dict_description = dict(
            [
                ('amount', amount), 
                ('expiration_date', expiration_date)
            ]
        )
        
        list.append(items.get(title), dict_description)
    else:
        dict_description = dict(
            [
                ('amount', amount), 
                ('expiration_date', expiration_date)
            ]
        )
        
        items[title] = [dict_description]
    
def add_by_note(items, note):
    # Разбираем строку
    note_list = str.split(note, ' ')
    expiration_date = None
    # Проверяем наличие в строке expiration_date
    split_note = str.split(note_list[-1], '-')
    if len(split_note) > 1:
        expiration_date = datetime.date(
            int(split_note[0]), 
            int(split_note[1]), 
            int(split_note[2])
        )
        amount = Decimal(note_list[-2])
        a = str.find(note, note_list[-2])
        title = note[0 : a-1]
    else:
        amount = Decimal(note_list[-1])
        a = str.find(note, note_list[-1])
        title = note[0 : a-1]
        
    dict_description = dict([('amount', amount), ('expiration_date', expiration_date)])
    if items.get(title) != None:
        list.append(items.get(title), dict_description)
    else:
        items[title] = [dict_description]
    

def find(items, needle):
    list_needle=[]
    list_keys = list(items.keys())
    needle = str.casefold(needle)
    
    for i in list_keys:
        if needle in str.casefold(i):
            list_needle.append(i)
            
    return list_needle
    

def amount(items, needle):
    list_needle=[]
    list_keys = list(items.keys())
    needle = str.casefold(needle)
    
    for i in list_keys:
        if needle in str.casefold(i):
            list_needle.append(i)
    
    total_amount = Decimal('0')
    for i in list_needle:
        list_dict = items.get(i)
        for amount in list_dict:
            total_amount += Decimal(amount['amount'])
    return total_amount


def expire(items, in_advance_days=0):
    # Получаем текущую дату
    now_date = datetime.date.today()
    expirate_list = []
    # Получаем список ключей из словаря
    list_keys = list(items.keys())
    print(list_keys)
    # Получаем список, который содержит expiration_date для каждого ключа
    for i in list_keys:
        list_dict = items.get(i)
        for a in list_dict:
            if a['expiration_date'] is not None:
                amount = a['amount']
                expiration_date = a['expiration_date']
                d = a['expiration_date'] - (now_date + datetime.timedelta(days=in_advance_days))
                
                if d.days <= 0 :
                    list.append(expirate_list, (i, amount))
                
    return(expirate_list)
                
print(expire(goods, 0))   

add(goods, 'Яйца фабрики №7', Decimal('0'), '2024-05-09')
add_by_note(goods, 'Яйца фабрики №1 10 2024-05-08')
#print(find(goods, 'яй'))
#print(amount(goods, 'пель'))

print(goods)
